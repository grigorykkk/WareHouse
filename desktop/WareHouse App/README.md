# WareHouse App (macOS)

Настольный клиент для ASP.NET Core бэкенда системы управления складами. Интерфейс на SwiftUI (macOS), архитектура MVVM, сетевой слой на `URLSession` с кешированием и офлайн‑режимом.

## Сборка и запуск
- Откройте `WareHouse App.xcodeproj` в Xcode 16+ и соберите/запустите целевую схему `WareHouse App` на macOS.
- Настройка подключения доступна в приложении через кнопку «Настройки» (верхний тулбар):
  - `Адрес бэкенда` – базовый URL (`http://localhost:5030` по умолчанию).
  - `Токен` – опциональный `Bearer`‑токен для `Authorization`.
- Для детерминированных UI‑тестов приложение можно запускать с аргументом `-uiTestSampleData`, который подставляет тестовые склады/инвентарь.

## Основные пользовательские потоки
- **Сводка складов**: список с поиском и сортировкой, карточка склада с емкостью/заполнением и флагами проблем. Переход на детали без перезапуска.
- **Детали склада**: таблица инвентаря с поиском/сортировкой, офлайн‑маркер, карточка рисков.
- **Поставка** (`POST /api/supplies`): форма позиций (ProductId, SupplierId, Name, UnitVolume, UnitPrice, ShelfLifeDays, Quantity) с валидацией на обязательность/положительные числа. Ответ от бэкенда сообщает, размещена ли поставка полностью; инвентарь перезагружается заново.
- **Перемещение** (`POST /api/transfers`): выбор исходного/целевого склада, предупреждения о просрочке и неподтвержденных типах, текст ошибок бэкенда. При успехе обновляется инвентарь обоих складов и журнал.
- **Анализ сети** (`GET /api/analysis`): ручной запуск, бэкенд возвращает статус по каждому складу, UI агрегирует флаги HasIssues/NeedsSortingOptimization/NeedsExpiredRemoval/NeedsTypeCorrection и подсвечивает проблемные склады.
- **Журнал** (`GET /api/logs`): вывод текстовых записей бэкенда, поиск и фильтрация по складу/типу операции/диапазону дат, явное отображение ошибок загрузки и кнопка повтора.

## Офлайн и кеширование
- Последние успешные ответы по складам, инвентарю, анализу и логам сохраняются в Application Support (`WareHouseAppCache/*.json`).
- При отсутствии сети отображаются метки «офлайн» с временем последнего обновления; при восстановлении соединения запускается фоновая синхронизация (склады, анализ, логи).
- Все ошибки и важные состояния логируются в `Application Support/WareHouseApp.log` для техподдержки.

## Доступность
- Голосовые подсказки для основных кнопок/табов и статусов, явные подписи полей форм, контрастные цвета.
- Ошибки проговариваются через доступные метки, элементы управления клавиатурой не отключены, текст использует системное масштабирование.

## Тесты
- Модульные тесты (`WareHouse AppTests`) покрывают сетевой слой: декодирование, обработку ошибок, заголовок `Authorization`.
- UI‑тесты (`WareHouse AppUITests`) проверяют сценарии поставки/перемещения/анализа на тестовых данных (`-uiTestSampleData`).
- Запуск из Xcode: выберите схему тестов и выполните `Product` → `Test`. CLI вариант: `xcodebuild test -scheme "WareHouse App" -destination 'platform=macOS'` (требует установленный симулятор/рантайм macOS).
